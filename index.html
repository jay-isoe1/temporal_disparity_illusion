<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>Shadow Illusion — p5.js</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <link rel="stylesheet" href="./style.css" />
  <style>
    /* Modern font stack for crisp UI text */
    body, details.explain-fixed {
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
    }
    /* Fixed (non-draggable) floating card in the upper-left */
    details.explain-fixed {
      position: fixed;
      top: 12px;
      left: 12px;
      z-index: 9999;
      width: clamp(220px, 28vw, 360px);
      background: rgba(255,255,255,0.75);
      color: #111;
      border: 1px solid rgba(255,255,255,0.35);
      border-radius: 12px;
      box-shadow: 0 10px 24px rgba(0,0,0,0.18);
      backdrop-filter: blur(10px) saturate(140%);
      -webkit-backdrop-filter: blur(10px) saturate(140%);
      overflow: hidden;
    }
    /* Header */
    details.explain-fixed summary {
      display: flex; align-items: center; gap: 8px;
      cursor: pointer; padding: 9px 12px;
      font-weight: 600;
      background: linear-gradient(180deg, rgba(255,255,255,.55), rgba(255,255,255,.35));
    }
    details.explain-fixed summary::-webkit-details-marker { display: none; }
    .dot { width: 8px; height: 8px; border-radius: 999px; background: #111; opacity: .65; }

    /* Body */
    .explain-body {
      padding: 12px 14px 14px;
      font-size: 0.85rem;
      line-height: 1.45;
      max-height: min(64vh, 520px);
      overflow: auto;
      -webkit-overflow-scrolling: touch;
    }

    /* Collapsed state: show only the header chip */
    details.explain-fixed:not([open]) .explain-body { display: none; }
  </style>
</head>
<body>
  <main id="app">
    <!-- Fixed at upper-left, collapsed by default (no 'open' attribute) -->
    <details class="explain-fixed" id="explainCard">
      <summary>
        <span class="dot"></span>
        Explanation
      </summary>
      <div class="explain-body">
        <h3>1) Layout & Math</h3>
        <p>\[
          \theta_i = i\,\Delta\theta,\quad
          r_i = r_{\text{start}} + i\,\Delta r,\quad
          x_i = x_c + r_i\cos\theta_i,\quad
          y_i = y_c + r_i\sin\theta_i.
        \]</p>
        <p>\[
          \theta_i^{(\mathrm{golden})} = i \cdot 137.5^\circ,\quad
          r_i^{(\mathrm{golden})} = r_{\text{start}} + 1.5\,i
        \]</p>
        <p>\[
          \mathrm{dir}_i=\begin{cases}+1&i\ \text{even}\\-1&i\ \text{odd}\end{cases},\quad
          \theta_i^{(\mathrm{double})}=i\,\Delta\theta\,\mathrm{dir}_i
        \]</p>

        <h3>2) Wave Layout</h3>
        <p>\[
          k=\frac{2\pi\cdot 4}{\text{cols}},\quad
          y_{\text{offset}}=A\sin(k\cdot \text{col})
        \]</p>

        <h3>3) Lightness Mapping</h3>
        <p>\[
          t=\frac{\text{col}}{\text{cols}-1},\quad
          L=
          \begin{cases}
            30 & t<0.25\\
            50 & 0.25\le t<0.50\\
            70 & 0.50\le t<0.75\\
            90 & 0.75\le t\le 1
          \end{cases}
        \]</p>

        <h3>4) Shadow Phase & Flip</h3>
        <p>\[
          \text{shadowShiftPhase} \leftarrow
          \mathrm{lerp}(\text{shadowShiftPhase},\ \pm 1,\ \text{shadowShiftSpeed})
        \]</p>
        <p>Flips polarity when <code>fadeDirection</code> reverses.</p>

        <h3>5) Layout + Shadow Modes</h3>
        <p>
          <strong>Layout</strong> (<code>spiralModeIndex</code>) decides positions (Linear, Golden, Double, Wave).
          <br><strong>Shadow</strong> (<code>shadowModeIndex</code>) decides black/white sides
          (Horizontal, Angular, Rotation-based, Eye-based, Wave).
        </p>
        <ul>
          <li><strong>Wave + Wave:</strong> synchronized shadows → smooth flow.</li>
          <li><strong>Wave + Horizontal:</strong> horizontal stripes across wavy layout.</li>
          <li><strong>Linear + Angular:</strong> radial flips by polar angle.</li>
        </ul>
        <p><em>Tip:</em> Pair Wave layout with Wave shadow for the cleanest illusion.</p>
      </div>
    </details>

    <!-- p5 canvas goes here -->
    <div id="canvas-wrap"></div>
  </main>

  <!-- libs -->
  <script src="https://cdn.jsdelivr.net/npm/p5@1.9.3/lib/p5.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/dat.gui@0.7.9/build/dat.gui.min.js"></script>
  <script src="sketch.js"></script>

  <!-- MathJax -->
  <script>
    window.MathJax = { tex: { inlineMath: [['\\(','\\)'], ['$', '$']] }, svg: { fontCache: 'global' } };
  </script>
  <script async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-svg.js"></script>
</body>
</html>
